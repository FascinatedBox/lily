import (Interpreter,
        TestCase) "../t/testing", utf8

class TestPkgUTF8 < TestCase
{
    public define test_as_list
    {
        assert_equal(utf8.as_list(""), [])
        assert_equal(utf8.as_list("abc"), [97, 98, 99])
        assert_equal(utf8.as_list("cafÃ©"), [99, 97, 102, 233])
        assert_equal(utf8.as_list("ðŸ™‚ðŸ™"), [128578, 128577])
        assert_equal(utf8.as_list(" â€‹ "), [32, 8203, 32])
    }

    public define test_compare
    {
        assert_equal(utf8.compare("", ""), 0)
        assert_equal(utf8.compare("abc", ""), 1)
        assert_equal(utf8.compare("abc", "def"), -1)
        assert_equal(utf8.compare("ðŸ™‚", "ðŸ™‚"), 0)
        assert_equal(utf8.compare("ðŸ™", "ðŸ™‚"), -1)
        assert_equal(utf8.compare("ðŸ™‚ðŸ™", "ðŸ™ðŸ™‚"), 1)
        assert_equal(utf8.compare(" â€‹ ", " â€‹ "), 0)
        assert_equal(utf8.compare(" â€‹ ", "   "), 1)

        assert_equal(["ðŸ™‚ðŸ™", "ðŸ™‚ðŸ™‚", "ðŸ™ðŸ™‚", "ðŸ™ðŸ™"].sort(utf8.compare),
                ["ðŸ™ðŸ™", "ðŸ™ðŸ™‚", "ðŸ™‚ðŸ™", "ðŸ™‚ðŸ™‚"])
    }

    public define test_each_codepoint
    {
        foreach string in ["", "abc", "cafÃ©", "ðŸ™‚ðŸ™", " â€‹ "]: {
            var codepoints: List[Integer] = []
            utf8.each_codepoint(string, (|c| codepoints.push(c)))
            assert_equal(codepoints, utf8.as_list(string))
        }
    }

    public define test_get
    {
        assert_equal(utf8.get("abc", 1), 98)
        assert_equal(utf8.get("cafÃ©", 3), 233)
        assert_equal(utf8.get("ðŸ™‚ðŸ™", -2), 128578)
        assert_equal(utf8.get(" â€‹ ", 1), 8203)

        assert_raises("IndexError: Index 0 is out of range.",
                (|| utf8.get("", 0) ))

        assert_raises("IndexError: Index 2 is out of range.",
                (|| utf8.get("ðŸ™‚ðŸ™", 2) ))

        assert_raises("IndexError: Index -3 is out of range.",
                (|| utf8.get("ðŸ™‚ðŸ™", -3) ))
    }

    public define test_length
    {
        assert_equal(utf8.length(""), 0)
        assert_equal(utf8.length("abc"), 3)
        assert_equal(utf8.length("cafÃ©"), 4)
        assert_equal(utf8.length("ðŸ™‚ðŸ™"), 2)
        assert_equal(utf8.length(" â€‹ "), 3)
    }

    public define test_slice
    {
        assert_equal(utf8.slice("abcdef", 1, 5), "bcde")
        assert_equal(utf8.slice("cafÃ©", 1, 4), "afÃ©")
        assert_equal(utf8.slice("ðŸ™‚ðŸ™", 0, 2), "ðŸ™‚ðŸ™")
        assert_equal(utf8.slice(" â€‹ ", 1, 2), "â€‹")

        assert_equal(utf8.slice("abcdef", 2, -2), "cd")
        assert_equal(utf8.slice("ðŸ™‚ðŸ™ðŸ™‚ðŸ™", -3, -1), "ðŸ™ðŸ™‚")
        assert_equal(utf8.slice(" â€‹ ", -2, -1), "â€‹")

        assert_equal(utf8.slice("abcdef", 3), "def")
        assert_equal(utf8.slice("cafÃ©", -3), "afÃ©")
        assert_equal(utf8.slice("ðŸ™‚ðŸ™", 1), "ðŸ™")

        assert_equal(utf8.slice(""), "")
        assert_equal(utf8.slice("abcdef"), "abcdef")
        assert_equal(utf8.slice("cafÃ©"), "cafÃ©")
        assert_equal(utf8.slice("ðŸ™‚ðŸ™"), "ðŸ™‚ðŸ™")

        assert_equal(utf8.slice("cafÃ©", 4), "")
        assert_equal(utf8.slice("cafÃ©", -5), "")
        assert_equal(utf8.slice("cafÃ©", 0, 5), "")
        assert_equal(utf8.slice("cafÃ©", 2, 1), "")
        assert_equal(utf8.slice("cafÃ©", -2, 1), "")
        assert_equal(utf8.slice("cafÃ©", 1, 1), "")
        assert_equal(utf8.slice("cafÃ©", -3, -3), "")
    }
}
